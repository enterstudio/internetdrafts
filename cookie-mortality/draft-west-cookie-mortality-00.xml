<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.0.28 -->

<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY RFC2119 SYSTEM "http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY RFC6265 SYSTEM "http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.6265.xml">
<!ENTITY RFC7258 SYSTEM "http://xml2rfc.ietf.org/public/rfc/bibxml/reference.RFC.7258.xml">
]>

<?rfc toc="yes"?>
<?rfc tocindent="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>
<?rfc strict="yes"?>
<?rfc compact="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>

<rfc ipr="trust200902" docName="draft-west-cookie-mortality-rate-00" category="std" updates="6265">

  <front>
    <title abbrev="cookie-mortality-rate">Increase Mortality Rate for Non-secure Origins' Cookies</title>

    <author initials="M." surname="West" fullname="Mike West">
      <organization>Google, Inc</organization>
      <address>
        <email>mkwst@google.com</email>
        <uri>https://mikewest.org/</uri>
      </address>
    </author>

    <date year="2016"/>

    <area>General</area>
    <workgroup>HTTPbis</workgroup>
    <keyword>Internet-Draft</keyword>

    <abstract>


<t>This document updates RFC6265 with the goal of increasing the rate at which
cookies set from non-secure origins are evicted from the cookie store.</t>



    </abstract>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>Something something user agents, powerful features, and secure transport
(see <xref target="SECURE-CONTEXTS"/>, <xref target="POWERFUL-FEATURES"/>, and <xref target="DEPRECATING-HTTP"/>).</t>

<t>Something something NSA <xref target="NSA-COOKIES"/>.</t>

<t>Something something pervasive monitoring <xref target="RFC7258"/>.</t>

<section anchor="example" title="Example">

<t>Assume <spanx style="verb">http://example.com/</spanx> sends the following header in 2016 (attempting to
set a cookie which expires after a few years):</t>

<figure><artwork><![CDATA[
Set-Cookie: A=B; expires=Thu, 31-Dec-2020 01:01:01 GMT;
]]></artwork></figure>

<t>This header will result in the creation of a cookie named <spanx style="verb">A</spanx> that expires
either when the user agent determines that “the current session is over”
(see Section 5.3 of <xref target="RFC6265"/>), or after XXX has passed.</t>

<t>If <spanx style="verb">https://example.com/</spanx> had sent the same header, the cookie would be stored
with the desired expiration date (though the browser would still be free to
remove it earlier than that as discussed in Section 7.3 of <xref target="RFC6265"/>.</t>

</section>
</section>
<section anchor="terminology-and-notation" title="Terminology and notation">

<t>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”,
“SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be
interpreted as described in <xref target="RFC2119"/>.</t>

</section>
<section anchor="recommendations" title="Recommendations">

<t>This document updates Section 5.3 of <xref target="RFC6265"/> as follows:</t>

<t><list style="numbers">
  <t>Add a new field to each cookie: <spanx style="verb">created-from-secure-context</spanx>.</t>
  <t>After step 9 of the current algorithm (which finishes setting the current
cookie fields), execute the following steps:  <list style="numbers">
      <t>If the origin of ‘request-uri’ is not “potentially trustworthy”
<xref target="SECURE-CONTEXTS"/>:      <list style="numbers">
          <t>Set the cookie’s <spanx style="verb">created-from-secure-context</spanx> flag to <spanx style="verb">false</spanx>.</t>
          <t>Set the cookie’s <spanx style="verb">persistent-flag</spanx> to <spanx style="verb">false</spanx>.</t>
          <t>If the cookie’s <spanx style="verb">expiry-time</spanx> is more than XXX in the future,
set the cookie’s <spanx style="verb">expiry-time</spanx> to the current date and time, plus
XXX.</t>
        </list>
Otherwise:      <list style="numbers">
          <t>Set the cookie’s <spanx style="verb">created-from-secure-context</spanx> to <spanx style="verb">true</spanx>.</t>
        </list></t>
    </list></t>
  <t>Change the eviction order at the bottom of the section to ensure that
cookies whose <spanx style="verb">created-from-secure-context</spanx> flag is <spanx style="verb">true</spanx> are evicted
only after all cookies whose <spanx style="verb">created-from-secure-context</spanx> flag is
<spanx style="verb">false</spanx>.</t>
</list></t>

</section>
<section anchor="implementation-considerations" title="Implementation Considerations">

<section anchor="expiring-session-cookies" title="Expiring Session Cookies">

<t>User agents may currently assume that it isn’t possible to have both a
meaningful <spanx style="verb">expiry-time</spanx> and <spanx style="verb">persistent-flag</spanx> of <spanx style="verb">false</spanx>. Chrome, for
instance, toggles a cookie’s <spanx style="verb">IsPersistent</spanx> property by checking that
<spanx style="verb">!expiry_date_.is_null()</spanx>. To implement the recommendations here, these flags
should be accessible independently.</t>

</section>
</section>


  </middle>

  <back>

    <references title='Normative References'>

<reference anchor="SECURE-CONTEXTS" target="https://w3c.github.io/webappsec-secure-contexts/">
  <front>
    <title>Secure Contexts</title>
    <author initials="M." surname="West" fullname="Mike West">
      <organization></organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
&RFC2119;
&RFC6265;
&RFC7258;


    </references>

    <references title='Informative References'>

<reference anchor="POWERFUL-FEATURES" target="https://www.chromium.org/Home/chromium-security/prefer-secure-origins-for-powerful-new-features">
  <front>
    <title>Prefer Secure Origins for Powerful New Features</title>
    <author initials="C." surname="Palmer" fullname="Chris Palmer">
      <organization></organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="DEPRECATING-HTTP" target="https://blog.mozilla.org/security/2015/04/30/deprecating-non-secure-http/">
  <front>
    <title>Deprecating Non-Secure HTTP</title>
    <author initials="R." surname="Barnes" fullname="Richard Barnes">
      <organization></organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="NSA-COOKIES" target="https://www.washingtonpost.com/news/the-switch/wp/2013/12/10/nsa-uses-google-cookies-to-pinpoint-targets-for-hacking/">
  <front>
    <title>NSA uses Google cookies to pinpoint targets for hacking</title>
    <author initials="A." surname="Soltani" fullname="Ashkan Soltani">
      <organization></organization>
    </author>
    <author initials="A." surname="Peterson" fullname="Andrea Peterson">
      <organization></organization>
    </author>
    <author initials="B." surname="Gellman" fullname="Barton Gellman">
      <organization></organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>
<reference anchor="Bugzilla1160368" target="https://bugzilla.mozilla.org/show_bug.cgi?id=1160368">
  <front>
    <title>Bug 1160368: Do not persist cookie without HTTPS 'secure' flag, i.e. treat HTTP cookies as session cookies.</title>
    <author initials="C." surname="Peterson" fullname="Chris Peterson">
      <organization></organization>
    </author>
    <date year="n.d."/>
  </front>
</reference>


    </references>


<section anchor="acknowledgements" title="Acknowledgements">

<t>Mozilla’s discussion (and, in particular, Chris Peterson’s experimentation) at
<xref target="Bugzilla1160368"/> has been instrumental in informing this proposal.</t>

</section>


  </back>
</rfc>

